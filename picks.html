<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Make Your Pick - Survivor Pool</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <!-- Sidebar -->
  <div id="sidebar" class="sidebar">
    <button class="close-btn" onclick="toggleSidebar()">×</button>
    <h2>NFL Survivor Pool</h2>
    <a href="dashboard.html">Dashboard</a>
    <a href="picks.html" class="active">Picks</a>
    <a href="standings.html">Standings</a>
    <a href="admin.html">Admin</a>
    <a href="index.html">Logout</a>
  </div>

  <!-- Hamburger Button -->
  <button class="menu-btn" onclick="toggleSidebar()">☰</button>
<div id="overlay" class="overlay" onclick="toggleSidebar()"></div>

  <main>
    <h2>Make Your Pick</h2>
    <p id="weekDisplay"></p>
    <p>Select one team below. You can only pick one per week.</p>

    <div id="matchupsContainer" class="matchups-container"></div>
    <p id="chosenDisplay" class="chosen-display"></p>
    <button id="submitPickBtn" disabled>Submit Pick</button>
  </main>

  <footer>
    <p>&copy; 2025 NFL Survivor Pool</p>
  </footer>

  <script>
  function toggleSidebar() {
    document.getElementById("sidebar").classList.toggle("active");
  }

  const matchups = JSON.parse(localStorage.getItem("matchups")) || [];
  const container = document.getElementById("matchupsContainer");
  const submitBtn = document.getElementById("submitPickBtn");
  const chosenDisplay = document.getElementById("chosenDisplay");
  const weekDisplay = document.getElementById("weekDisplay");

  let chosenTeam = localStorage.getItem("chosenTeam") || "";
  let currentWeek = parseInt(localStorage.getItem("currentWeek")) || 1;
  weekDisplay.textContent = `Current Week: ${currentWeek}`;

  function renderMatchups() {
    container.innerHTML = "";
    const weekMatchups = matchups.filter(m => m.week === currentWeek);
    if (weekMatchups.length === 0) {
      container.innerHTML = "<p>No matchups available yet. Check back later!</p>";
      return;
    }

    weekMatchups.forEach((m) => {
      const home = m.home, away = m.away, spread = parseFloat(m.spread);
      let leftTeam, rightTeam, displaySpread, middleText;
      if (!isNaN(spread)) {
        if (spread < 0) { leftTeam = home; rightTeam = away; displaySpread = `-${Math.abs(spread)}`; middleText = "vs"; }
        else if (spread > 0) { leftTeam = away; rightTeam = home; displaySpread = `-${Math.abs(spread)}`; middleText = "@"; }
        else { leftTeam = home; rightTeam = away; displaySpread = ""; middleText = "vs"; }
      } else { leftTeam = home; rightTeam = away; displaySpread = ""; middleText = "vs"; }

      const matchupDiv = document.createElement("div");
      matchupDiv.classList.add("matchup");
      matchupDiv.innerHTML = `
        <div class="matchup-row">
          <button class="team-btn" onclick="chooseTeam('${leftTeam}')">${leftTeam}</button>
          <span class="spread">${displaySpread} ${middleText}</span>
          <button class="team-btn" onclick="chooseTeam('${rightTeam}')">${rightTeam}</button>
        </div>
      `;
      container.appendChild(matchupDiv);
    });

    if (chosenTeam) {
      chosenDisplay.innerText = `You picked: ${chosenTeam}`;
      submitBtn.disabled = false;
      const selectedBtn = [...document.querySelectorAll(".team-btn")].find(b => b.textContent === chosenTeam);
      if (selectedBtn) selectedBtn.classList.add("selected");
    }
  }

  function chooseTeam(team) {
    chosenTeam = team;
    localStorage.setItem("chosenTeam", team);
    chosenDisplay.innerText = `You picked: ${team}`;
    submitBtn.disabled = false;
    document.querySelectorAll(".team-btn").forEach(btn => btn.classList.remove("selected"));
    const selectedBtn = [...document.querySelectorAll(".team-btn")].find(b => b.textContent === team);
    if (selectedBtn) selectedBtn.classList.add("selected");
  }

  submitBtn.addEventListener("click", () => {
    const username = localStorage.getItem("username") || "Dominic";
    const chosenTeamAbbr = chosenTeam.substring(0, 3).toUpperCase();
    let players = JSON.parse(localStorage.getItem("players")) || [];
    let player = players.find(p => p.username === username);
    if (!player) { player = { username, picks: [], alive: true }; players.push(player); }
    if (!player.alive) return alert("You’ve been eliminated and cannot make further picks.");
    const existingPick = player.picks.find(p => p.week === currentWeek);
    if (existingPick) { existingPick.team = chosenTeamAbbr; existingPick.result = "pending"; }
    else { player.picks.push({ week: currentWeek, team: chosenTeamAbbr, result: "pending" }); }
    localStorage.setItem("players", JSON.stringify(players));
    alert(`You submitted your Week ${currentWeek} pick: ${chosenTeamAbbr}`);
  });

  renderMatchups();
  </script>
</body>
</html>
