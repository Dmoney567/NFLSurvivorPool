<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Standings - Survivor Pool</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <!-- Sidebar -->
  <div id="sidebar" class="sidebar">
    <button class="close-btn" onclick="toggleSidebar()">×</button>
    <h2>NFL Survivor Pool</h2>
    <a href="dashboard.html">Dashboard</a>
    <a href="picks.html">Picks</a>
    <a href="standings.html" class="active">Standings</a>
    <a href="admin.html">Admin</a>
    <a href="pools.html">Pools</a>
    <a href="index.html">Logout</a>
  </div>
  <button class="menu-btn" onclick="toggleSidebar()">☰</button>
  <div id="overlay" class="overlay" onclick="toggleSidebar()"></div>

  <main class="standings-container">
    <h2>Pool Standings</h2>
    <div id="poolInfo" class="dashboard-card"></div>

    <table id="standingsTable">
      <thead>
        <tr id="weeksHeader"><th>Player</th></tr>
      </thead>
      <tbody id="standingsBody"></tbody>
    </table>
  </main>

  <footer><p>&copy; 2025 NFL Survivor Pool</p></footer>

  <script>
  // =====================
  // Sidebar
  // =====================
  function toggleSidebar() {
    const sidebar = document.getElementById("sidebar");
    const overlay = document.getElementById("overlay");
    const isActive = sidebar.classList.toggle("active");
    overlay.classList.toggle("active", isActive);
  }

  // =====================
  // Pool Data
  // =====================
  const pools = JSON.parse(localStorage.getItem("pools")) || [];
  const poolId = localStorage.getItem("currentPoolId");
  const pool = pools.find(p => p.id === poolId);
  const poolInfo = document.getElementById("poolInfo");
  const header = document.getElementById("weeksHeader");
  const body = document.getElementById("standingsBody");

  if (!pool) {
    poolInfo.innerHTML = "<p>No pool selected. Go to Pools page to select one.</p>";
  } else {
    poolInfo.innerHTML = `
      <p><strong>Pool:</strong> ${pool.name}</p>
      <p><strong>Owner:</strong> ${pool.owner}</p>
      <p><strong>Current Week:</strong> ${pool.currentWeek}</p>
    `;

    renderStandings();
  }

  // =====================
  // Render Table
  // =====================
  function renderStandings() {
    body.innerHTML = "";
    header.innerHTML = "<th>Player</th>";

    // Find max week any member has picks for
    const maxWeeks = pool.members.reduce((max, m) => {
      const lastPickWeek = m.picks.length ? Math.max(...m.picks.map(p => p.week)) : 0;
      return Math.max(max, lastPickWeek);
    }, pool.currentWeek);

    // Create week columns
    for (let w = 1; w <= maxWeeks; w++) {
      const th = document.createElement("th");
      th.textContent = "Week " + w;
      header.appendChild(th);
    }

    // Render members
    pool.members.forEach(member => {
      const row = document.createElement("tr");
      const nameCell = document.createElement("td");
      nameCell.textContent = member.username + (member.role === "owner" ? " ⭐" : "");
      nameCell.classList.add("name-cell");
      row.appendChild(nameCell);

      for (let w = 1; w <= maxWeeks; w++) {
        const pick = member.picks.find(p => p.week === w);
        const cell = document.createElement("td");
        cell.classList.add("pick-cell");

        if (!pick) {
          cell.textContent = "-";
        } else if (pick.result === "win") {
          cell.textContent = pick.team;
          cell.classList.add("win");
        } else if (pick.result === "loss") {
          cell.textContent = pick.team;
          cell.classList.add("loss");
        } else if (pick.result === "locked") {
          cell.textContent = "-";
          cell.classList.add("future-locked");
        } else {
          cell.textContent = pick.team;
        }

        row.appendChild(cell);
      }

      body.appendChild(row);
    });
  }
  </script>
</body>
</html>
